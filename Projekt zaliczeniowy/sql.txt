#Dodawanie, usuwanie, aktualizacja rekordów

INSERT INTO SAMOCHODY (MPG, CYLINDERS, DISPLACEMENT, HORSEPOWER, WEIGHT, ACCELERATION, YEAR, ORIGIN, NAME) 
  VALUES (18.0, 8, 320.0, 120.0, 3500.0, 10.0, 1975, 1, 'bugatti_chiron');

DELETE FROM SAMOCHODY WHERE ID = 5;

UPDATE SAMOCHODY SET MPG = "17.0", CYLINDERS = "7" WHERE ID = "5";
 


#Archiwizacja usuniętych danych:

CREATE TRIGGER ARCH AFTER DELETE ON 'SAMOCHODY'
FOR EACH ROW
BEGIN
  INSERT INTO ARCHIWUM (MPG, CYLINDERS, DISPLACEMENT, HORSEPOWER, WEIGHT, ACCELERATION, YEAR, ORIGIN, NAME)
  VALUES (OLD.MPG, OLD.CYLINDERS, OLD.DISPLACEMENT, OLD.HORSEPOWER, OLD.WEIGHT, OLD.ACCELERATION, OLD.YEAR, OLD.ORIGIN, OLD.NAME);
END



#Tworzenie tabeli z logami:

CREATE TABLE HISTORIA (
  'ID' INT NOT NULL AUTO_INCREMENT AUTO_INCREMENT,
  'ID_TABELA' INT NOT NULL,
  'ZMIANA' ENUM('INSERT','UPDATE','DELETE') NOT NULL,
  'CZAS' TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  'MPG' DOUBLE DEFAULT NULL,
  'CYLINDERS' BIGINT(20) DEFAULT NULL,
  'DISPLACEMENT' DOUBLE DEFAULT NULL,
  'HORSEPOWER' DOUBLE DEFAULT NULL,
  'WEIGHT' DOUBLE DEFAULT NULL,
  'ACCELERATION' DOUBLE DEFAULT NULL,
  'YEAR' BIGINT(20) DEFAULT NULL,
  'ORIGIN' BIGINT(20) DEFAULT NULL,
  'NAME' BIGINT(20) DEFAULT NULL,
  PRIMARY KEY ('ID')
);



#Triggery obsługujące dodawanie, usuwanie i aktualizowanie rekordów

CREATE TRIGGER TRIGGER1 AFTER INSERT ON 'SAMOCHODY'
FOR EACH ROW
BEGIN
  INSERT INTO HISTORIA (ID_TABELA, ZMIANA, MPG, CYLINDERS, DISPLACEMENT, HORSEPOWER, WEIGHT, ACCELERATION, YEAR, ORIGIN, NAME)
  VALUES (NEW.ID, 'insert', NEW.MPG, NEW.CYLINDERS, NEW.DISPLACEMENT, NEW.HORSEPOWER, NEW.WEIGHT, NEW.ACCELERATION, NEW.YEAR, NEW.ORIGIN, NEW.NAME);
END

CREATE TRIGGER TRIGGER2 AFTER UPDATE ON 'SAMOCHODY'
FOR EACH ROW
BEGIN
  INSERT INTO HISTORIA (ID_TABELA, ZMIANA, MPG, CYLINDERS, DISPLACEMENT, HORSEPOWER, WEIGHT, ACCELERATION, YEAR, ORIGIN, NAME)
  VALUES (NEW.ID, 'UPDATE', NEW.MPG, NEW.CYLINDERS, NEW.DISPLACEMENT, NEW.HORSEPOWER, NEW.WEIGHT, NEW.ACCELERATION, NEW.YEAR, NEW.ORIGIN, NEW.NAME);
END

CREATE TRIGGER TRIGGER3 AFTER DELETE ON 'SAMOCHODY'
FOR EACH ROW
BEGIN
  INSERT INTO HISTORIA (ID_TABELA, ZMIANA, MPG, CYLINDERS, DISPLACEMENT, HORSEPOWER, WEIGHT, ACCELERATION, YEAR, ORIGIN, NAME)
  VALUES (NEW.ID, 'DELETE', NEW.MPG, NEW.CYLINDERS, NEW.DISPLACEMENT, NEW.HORSEPOWER, NEW.WEIGHT, NEW.ACCELERATION, NEW.YEAR, NEW.ORIGIN, NEW.NAME);
END